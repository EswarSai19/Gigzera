{% extends 'master.html' %} {% load static %}
<!-- Title -->
{% block title %}Jobs{% endblock %}
<!-- CSS -->
{% block css %}
<link rel="stylesheet" href="{% static 'css/tailwind.css' %}" />
<link rel="stylesheet" href="{% static 'css/fl_jobs.css' %}" />
{% endblock %}
<!-- Main -->
{% block content %}
<main>
  <!-- Left section -->
  <aside class="left-section">
    <!-- Filter Jobs Section -->
    <div id="hamburger-icon-left" class="hamburger-icon-left hide1">
      <i class="fa-solid fa-forward"></i>
    </div>

    <!-- Popup Section -->
    <section id="social-media-updates-left" class="popup-left hide1">
      <div class="popup-content-left">
        <button id="close-popup-btn-left" class="close-popup-btn-left">
          &times;
        </button>

        <!-- Filter Box inside the popup -->
        <div class="filter-box">
          <i class="fa-solid fa-filter filter-icon"></i>
          <input
            type="text"
            id="job-filter"
            placeholder="Filter jobs..."
            class="filter-input"
          />
        </div>
        <div class="social-media-box">
          <h3>Social Media Updates</h3>

          <a
            href="https://x.com/gigzera?t=6u9xg6cCXeWSBQHH1vP8Ig&s=08"
            target="_blank"
            class="social-update"
          >
            <i class="fa-brands fa-twitter icon"></i>
            <p>Latest job opportunities in #WebDevelopment...</p>
          </a>

          <a
            href="https://www.linkedin.com/company/gigzera/"
            target="_blank"
            class="social-update"
          >
            <i class="fa-brands fa-linkedin icon"></i>
            <p>Join our tech community on LinkedIn...</p>
          </a>

          <a
            href="https://www.facebook.com/share/1A6ghPZxaC/?mibextid=wwXIfr"
            target="_blank"
            class="social-update"
          >
            <i class="fa-brands fa-facebook icon"></i>
            <p>Join our tech community on Facebook...</p>
          </a>

          <a
            href="https://www.instagram.com/gigzera?igsh=MWNzZzhjcWcybjE3Ng=="
            target="_blank"
            class="social-update"
          >
            <i class="fa-brands fa-instagram icon"></i>
            <p>Join our tech community on Instagram...</p>
          </a>
        </div>
        <!-- Announcement Video Section -->
        <div class="announcement-box">
          <h1>Announcement</h1>
          <div class="ad-box lf-annc-box">
            <!-- Video 1 -->
            {% if web_obj.media_type == "Image" %}

            <img
              src="{{web_obj.media_url}}"
              alt="Advertisement"
              class="w-full h-full object-cover"
            />

            {% else %}
            <div class="ad-video-container active">
              <video id="video1" autoplay muted>
                <source src="{{web_obj.media_url}}" type="video/mp4" />
                Your browser does not support the video tag.
              </video>
            </div>
            {% endif %}
          </div>
          <p>{{web_obj.anc_text}}</p>
          <br />
        </div>

        <!-- Image Section (Slideshow) -->
        <section class="text-section-left">
          <div
            class="relative w-full h-[180px] max-w-lg mx-auto overflow-hidden rounded-lg shadow-lg mt-8"
          >
            <div class="slider slider-5 relative w-full h-56">
              {% for img in images %}
              <div
                class="slide slide-5 absolute w-full h-full opacity-0 transition-opacity duration-1000 cursor-pointer pointer-events-none"
              >
                <img
                  src="{{img.media_url}}"
                  alt="Advertisement"
                  class="w-full h-full object-cover"
                />
              </div>
              {% endfor %}
            </div>
          </div>
        </section>
      </div>
    </section>

    <div class="filter-box hide-on-mobile">
      <i class="fa-solid fa-filter filter-icon"></i>
      <input
        type="text"
        id="job-filter"
        placeholder="Filter jobs..."
        class="filter-input"
      />
    </div>

    <!-- Social Media Updates Section -->
    <div class="social-media-box hide-on-mobile">
      <h3>Social Media Updates</h3>

      <a
        href="https://x.com/gigzera?t=6u9xg6cCXeWSBQHH1vP8Ig&s=08"
        target="_blank"
        class="social-update"
      >
        <i class="fa-brands fa-twitter icon"></i>
        <p>Latest job opportunities in #WebDevelopment...</p>
      </a>

      <a
        href="https://www.linkedin.com/company/gigzera/"
        target="_blank"
        class="social-update"
      >
        <i class="fa-brands fa-linkedin icon"></i>
        <p>Join our tech community on LinkedIn...</p>
      </a>

      <a
        href="https://www.facebook.com/share/1A6ghPZxaC/?mibextid=wwXIfr"
        target="_blank"
        class="social-update"
      >
        <i class="fa-brands fa-facebook icon"></i>
        <p>Join our tech community on Facebook...</p>
      </a>

      <a
        href="https://www.instagram.com/gigzera?igsh=MWNzZzhjcWcybjE3Ng=="
        target="_blank"
        class="social-update"
      >
        <i class="fa-brands fa-instagram icon"></i>
        <p>Join our tech community on Instagram...</p>
      </a>
    </div>
    <div class="announcement-box hide-on-mobile">
      <h1>Announcement</h1>
      <div class="ad-box lf-annc-box">
        <!-- Video 1 -->
        {% if web_obj.media_type == "Image" %}

        <img
          src="{{web_obj.media_url}}"
          alt="Advertisement"
          class="w-full h-full object-cover"
        />

        {% else %}
        <div class="ad-video-container active">
          <video id="video1" autoplay muted>
            <source src="{{web_obj.media_url}}" type="video/mp4" />
            Your browser does not support the video tag.
          </video>
        </div>
        {% endif %}
      </div>
      <p>{{web_obj.anc_text}}</p>
      <br />
    </div>
    <section class="text-section-left hide-on-mobile">
      <div
        class="relative w-full h-[180px] max-w-lg mx-auto overflow-hidden rounded-lg shadow-lg mt-8"
      >
        <div class="slider slider-4 relative w-full h-56">
          {% for img in images %}
          <div
            class="slide slide-4 absolute w-full h-full opacity-0 transition-opacity duration-1000 cursor-pointer pointer-events-none"
          >
            <img
              src="{{img.media_url}}"
              alt="Advertisement"
              class="w-full h-full object-cover"
            />
          </div>
          {% endfor %}
        </div>
      </div>
    </section>
  </aside>

  <!-- Modal pop up for provide quote -->
  <div
    id="quoteModal"
    class="hidden fixed inset-0 bg-blur bg-opacity-50 flex justify-center items-center z-50"
  >
    <div
      class="bg-white rounded-lg shadow-lg w-full max-w-2xl mx-auto p-10 relative"
    >
      <!-- Close Button -->
      <button
        onclick="closeModal()"
        class="absolute top-4 right-4 text-gray-500 hover:text-gray-700"
      >
        <i class="fa-solid fa-xmark text-2xl"></i>
      </button>

      <!-- Modal Header -->
      <div class="text-center mb-6">
        <div class="flex justify-center items-center mb-2">
          <i class="fa-solid fa-paper-plane text-blue-500 text-3xl mr-2"></i>
          <h1 class="text-2xl font-bold text-blue-500">Apply</h1>
        </div>
        <h3 class="text-lg font-semibold text-gray-800">Apply for Project</h3>
        <p class="text-sm text-gray-600">
          Provide the required information to apply for this project.
        </p>
      </div>
      <!-- Form -->
      <form id="quoteForm" method="POST" action="{% url 'submit_quote' %}">
        <!-- Budget Field -->
        {% csrf_token %}
        <input type="hidden" id="quote_opportunityId" name="opportunity_id" />
        <!-- <input type="hidden" id="quote_title" name="title" />
        <input type="hidden" id="quote_currency" name="currency" />
        <input type="hidden" id="quote_cur_symbol" name="cur_symbol" /> -->
        <div class="mb-4">
          <label for="budget" class="block text-sm font-semibold text-gray-700">
            Budget <span class="text-red-500">*</span>
          </label>
          <div class="flex items-center border rounded-md">
            <span
              class="px-3 py-2 text-gray-700 text-sm rounded-l-md"
              id="quote_currency"
              >{{job.cur_symbol}}</span
            >
            <input
              type="number"
              step="0.000000001"
              id="budget"
              name="budget"
              placeholder="Budget: Estimation to complete the project"
              required
              class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>
        </div>

        <!-- Timeline Field -->
        <div class="mb-4">
          <label
            for="timeline"
            class="block text-sm font-semibold text-gray-700"
          >
            Estimated Time to Complete the Project
            <span class="text-red-500">*</span>
          </label>
          <input
            type="number"
            step="0.001"
            id="timeline"
            name="time_estimation"
            placeholder="E.g., 3"
            required
            class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>

        <!-- Comments Field -->
        <div class="mb-6">
          <label
            for="comments"
            class="block text-sm font-semibold text-gray-700"
          >
            Comments
          </label>
          <textarea
            id="comments"
            name="comments"
            placeholder="Queries related to scope of the project or tools & licenses"
            class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          ></textarea>
        </div>

        <!-- Submit Button -->
        <button
          type="submit"
          class="w-full bg-gradient-to-r from-blue-600 to-blue-800 text-white font-bold py-2 px-4 rounded-md cursor-pointer"
        >
          Submit Quotation
        </button>
      </form>
    </div>
  </div>

  <!-- Not a fretured jobs -->
  <!-- <div class="flex">
    <section class="featured-jobs">
      <div class="ctnr">
        <div class="job-cards">
          {% for job in jobs %}
          <div
            class="job-card border p-4 mb-4 rounded shadow"
            data-title="{{ job.title }}"
          >
            <div class="job-title font-bold text-lg">
              {{ job.title }}
              <span class="job-id text-gray-500"
                >(Opp ID: {{ job.opportunityId }})</span
              >
            </div>
            <div class="job-duration-salary text-sm text-gray-700">
              <span class="duration">⏳ {{ job.duration }}</span>
              <span class="salary ml-4"
                >💳 {{job.cur_symbol}} {{ job.budget }}</span
              >
            </div>
            <p class="job-description text-gray-600 mt-2">
              {{ job.description }}
            </p>
            <div class="job-tags mt-2">
              {% for tag in job.skills_list %}
              <span class="tag bg-blue-100 text-blue-700 px-2 py-1 rounded"
                >{{ tag }}</span
              >
              {% endfor %}
            </div>
            <div class="job-actions mt-3">
              <button
                class="px-4 py-2 text-blue-600 border border-blue-600 rounded-lg hover:text-white hover:bg-blue-600 cursor-pointer"
                hx-post="{% url 'load_job_details' %}"
                hx-vals='{"job_id": "{{ job.opportunityId }}"}'
                hx-target="#tailwind-popup-content"
                hx-swap="innerHTML"
                hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                onclick="tailwindOpenModal()"
              >
                View More
              </button>
              <button
                class="btn btn-primary provide-quote bg-blue-500 text-white px-4 py-2 rounded ml-2 cursor-pointer"
                onclick="openModal('{{ job.opportunityId }}', '{{ job.cur_symbol }}', '{{ job.duration }}', '{{ job.budget }}')"
              >
                Provide Quote
              </button>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </section>
  </div> -->

  <!-- New featured jobs -->
  <section class="featured-jobs">
    <div class="ctnr">
      <div class="job-cards">
        <!--  -->
        {% for job in jobs %}
        <!-- Job Card -->
        <div class="job-card" data-title="{{ job.title }}">
          <div class="job-title">
            {{ job.title }}
            <span class="job-id">(Opp ID: {{ job.opportunityId }})</span>
          </div>
          <div class="job-duration-salary">
            <span class="duration">⏳ {{ job.duration }}</span>
            <span class="salary">💳 {{ job.budget }}</span>
          </div>
          <p class="job-description">{{ job.description }}</p>
          <div class="job-tags">
            {% for tag in job.skills_list %}
            <span class="tag">{{ tag }}</span>
            {% endfor %}
          </div>
          <div class="job-actions mt-3">
            <button
              class="px-4 py-2 text-blue-600 border border-blue-600 rounded-lg hover:text-white hover:bg-blue-600 cursor-pointer"
              hx-post="{% url 'load_job_details' %}"
              hx-vals='{"job_id": "{{ job.opportunityId }}"}'
              hx-target="#tailwind-popup-content"
              hx-swap="innerHTML"
              hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
              onclick="tailwindOpenModal()"
            >
              View More
            </button>
            <button
              class="btn btn-primary provide-quote bg-blue-500 text-white px-4 py-2 rounded ml-2 cursor-pointer"
              onclick="openModal('{{ job.opportunityId }}', '{{ job.cur_symbol }}', '{{ job.duration }}', '{{ job.budget }}')"
            >
              Provide Quote
            </button>
          </div>
        </div>

        {% if job.show_ad %}
        <div
          class="relative h-[180px] w-full max-w-lg mx-auto overflow-hidden rounded-lg shadow-lg mt-8"
        >
          <div class="slider slider-{{job.slider_class}} relative w-full h-56">
            {% for adv in job.ad_section %} {% if adv.media_type == "Image" %}
            <div
              class="slide slide-{{job.slider_class}} absolute w-full h-full opacity-0 transition-opacity duration-1000 cursor-pointer pointer-events-none"
              data-url="{{ adv.redirect_link }}"
            >
              <img
                src="{{ adv.media_url }}"
                alt="Advertisement"
                class="w-full h-full object-cover"
              />
            </div>
            {% elif adv.media_type == "Video" %}
            <div
              class="slide slide-{{job.slider_class}} absolute w-full h-full opacity-0 transition-opacity duration-1000 cursor-pointer pointer-events-none"
              data-url="{{ adv.redirect_link }}"
            >
              <video class="w-full h-full object-cover" autoplay muted loop>
                <source src="{{ adv.media_url }}" type="video/mp4" />
                Your browser does not support the video tag.
              </video>
            </div>
            {% endif %} {% endfor %}
          </div>
        </div>
        {% endif %}

        <!--  -->
        {% endfor %}
        <!--  -->
      </div>
    </div>
  </section>

  <!-- Toggle right offcanvas of view more button  -->
  <div
    id="tailwind-overlay"
    class="fixed inset-0 bg-grey-50 bg-opacity-50 z-50 hidden"
  >
    <div
      id="tailwind-popup"
      class="fixed right-0 top-0 h-full w-[600px] bg-white shadow-2xl overflow-hidden z-50 hidden"
    >
      <div
        id="tailwind-popup-header"
        class="flex justify-between items-center p-6 border-b"
      >
        <div class="flex items-center space-x-2">
          <i class="fa-solid fa-bolt text-blue-600 text-2xl"></i>
          <span class="text-xl font-bold text-blue-600">Gigzera</span>
        </div>
        <button
          id="tailwind-close-drawer"
          class="text-gray-500 hover:text-gray-700"
        >
          <i class="fa-solid fa-xmark text-xl"></i>
        </button>
      </div>
      <div
        id="tailwind-popup-content"
        class="p-6 h-[calc(100vh-180px)] overflow-y-auto"
      >
        <!-- Dynamic content coming from the job_details_partial page -->
      </div>
    </div>
  </div>

  <!-- Right Section -->
  <aside class="right-section hide-on-mobile">
    <!-- First Ad Box: Two Videos -->
    <div
      class="relative h-[180px] w-full max-w-lg mx-auto overflow-hidden rounded-lg shadow-lg mt-8"
    >
      <div class="slider slider-1 relative w-full h-56">
        {% for adv in sec1 %} {% if adv.media_type == "Image" %}
        <div
          class="slide slide-1 absolute w-full h-full opacity-0 transition-opacity duration-1000 cursor-pointer pointer-events-none"
          data-url="{{adv.redirect_link}}"
        >
          <img
            src="{{adv.media_url}}"
            alt="Advertisement"
            class="w-full h-full object-cover"
          />
        </div>
        {% elif adv.media_type == "Video" %}
        <div
          class="slide slide-1 absolute w-full h-full opacity-0 transition-opacity duration-1000 cursor-pointer pointer-events-none"
          data-url="{{adv.redirect_link}}"
        >
          <video class="w-full h-full object-cover" autoplay muted loop>
            <source src="{{adv.media_url}}" type="video/mp4" />
            Your browser does not support the video tag.
          </video>
        </div>
        {% endif %} {% endfor %}
      </div>
    </div>

    <!-- Second Ad Box with Image Slideshow -->
    <div
      class="relative h-[180px] w-full max-w-lg mx-auto overflow-hidden rounded-lg shadow-lg mt-8"
    >
      <div class="slider slider-2 relative w-full h-56">
        {% for adv in sec2 %} {% if adv.media_type == "Image" %}
        <div
          class="slide slide-2 absolute w-full h-full opacity-0 transition-opacity duration-1000 cursor-pointer pointer-events-none"
          data-url="{{adv.redirect_link}}"
        >
          <img
            src="{{adv.media_url}}"
            alt="Advertisement"
            class="w-full h-full object-cover"
          />
        </div>
        {% elif adv.media_type == "Video" %}
        <div
          class="slide slide-2 absolute w-full h-full opacity-0 transition-opacity duration-1000 cursor-pointer pointer-events-none"
          data-url="{{adv.redirect_link}}"
        >
          <video class="w-full h-full object-cover" autoplay muted loop>
            <source src="{{adv.media_url}}" type="video/mp4" />
            Your browser does not support the video tag.
          </video>
        </div>
        {% endif %} {% endfor %}
      </div>
    </div>

    <!-- Third Ad Box with Image Slideshow -->
    <div
      class="relative h-[180px] w-full max-w-lg mx-auto overflow-hidden rounded-lg shadow-lg mt-8"
    >
      <div class="slider slider-3 relative w-full h-56">
        {% for adv in sec3 %} {% if adv.media_type == "Image" %}
        <div
          class="slide slide-3 absolute w-full h-full opacity-0 transition-opacity duration-1000 cursor-pointer pointer-events-none"
          data-url="{{adv.redirect_link}}"
        >
          <img
            src="{{adv.media_url}}"
            alt="Advertisement"
            class="w-full h-full object-cover"
          />
        </div>
        {% elif adv.media_type == "Video" %}
        <div
          class="slide slide-3 absolute w-full h-full opacity-0 transition-opacity duration-1000 cursor-pointer pointer-events-none"
          data-url="{{adv.redirect_link}}"
        >
          <video class="w-full h-full object-cover" autoplay muted loop>
            <source src="{{adv.media_url}}" type="video/mp4" />
            Your browser does not support the video tag.
          </video>
        </div>
        {% endif %} {% endfor %}
      </div>
    </div>
  </aside>
</main>
{% endblock %}

<!-- JS -->
{% block js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Create a function to initialize a slider
    function initializeSlider(sliderNumber) {
      const slides = document.querySelectorAll(`.slide-${sliderNumber}`);
      if (slides.length === 0) {
        console.log(`No slides found for slider-${sliderNumber}`);
        return;
      }

      let currentIndex = 0;
      let autoAdvanceTimer = null;

      function showSlide(index) {
        // Clear any existing timer
        if (autoAdvanceTimer) {
          clearTimeout(autoAdvanceTimer);
          autoAdvanceTimer = null;
        }

        slides.forEach((slide, i) => {
          if (i === index) {
            slide.classList.add("opacity-100");
            slide.classList.remove("opacity-0", "pointer-events-none");

            // Check if this slide has a video
            const video = slide.querySelector("video");
            if (video) {
              // Remove loop attribute if it exists
              video.removeAttribute("loop");

              // Reset video to beginning
              video.currentTime = 0;

              // Play the video and set up the ended event
              video
                .play()
                .then(() => {
                  // Make sure onended is set after play starts
                  video.onended = function () {
                    nextSlide();
                  };
                })
                .catch((err) => {
                  console.error("Video playback error:", err);
                  // If video fails to play, use fallback timer
                  autoAdvanceTimer = setTimeout(nextSlide, 5000);
                });
            } else {
              // For non-video slides, use the timer
              autoAdvanceTimer = setTimeout(nextSlide, 5000);
            }
          } else {
            slide.classList.remove("opacity-100");
            slide.classList.add("opacity-0", "pointer-events-none");

            // Pause any videos in hidden slides
            const video = slide.querySelector("video");
            if (video) {
              video.pause();
              // Remove any existing onended handlers
              video.onended = null;
            }
          }
        });
      }

      function nextSlide() {
        currentIndex = (currentIndex + 1) % slides.length;
        showSlide(currentIndex);
      }

      // Add click event listeners to open links in new tabs
      slides.forEach((slide) => {
        slide.addEventListener("click", function () {
          const url = this.getAttribute("data-url");
          if (url) {
            window.open(url, "_blank");
          }
        });
      });

      showSlide(currentIndex);
    }

    // Initialize all your sliders
    initializeSlider(1); // For sec1
    initializeSlider(2); // For sec2
    initializeSlider(3); // For sec2
    initializeSlider(4); // For sec2
    initializeSlider(5); // For sec2
    initializeSlider(6); // For sec2
    initializeSlider(7); // For sec2
    initializeSlider(8); // For sec2
    // Add more as needed
  });
</script>
<script src="{% static 'js/fl_jobs.js' %}"></script>
{% endblock %}
